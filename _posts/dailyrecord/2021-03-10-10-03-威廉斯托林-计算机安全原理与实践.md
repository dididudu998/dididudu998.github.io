---
layout: post
title: 威廉斯托林-计算机安全原理与实践
category: 读书笔记
tags: 
description: 
---

# 威廉斯托林-计算机安全原理与实践

## 口令

- 先验口令
  - 工具： 开源软件pam_passwdqc(openwall.com/passwdqc/)
  - 在进行口令设置时，执行各种规则，并可以由管理员进行配置

- 口令破解器
  - 当用户在选择一个口令时候，将由破解器进行检查，确保这个口令不在破解器字典内。
  - 问题是，随着人员的增多和时间，口令字典会变得越来越大，检查时间会越来越长

- Bloom过滤器
 - spafford提出的基于Bloom的过滤器，是概率统计的技术。用于生成高效的后验证口令检查。


## 令牌

 用户持有的，用于进行认证的一种物品。

- 存储卡： 只存储数据，而不处理数据，用于单独的物理访问
  - 需要读卡器
  - 会丢失或者被盗窃
  - 用户的满意度不高

- 智能卡：带有微处理器，可以处理一些数据，有接触式和非接触式的，带有人机接口，按钮或者液晶显示。
  - 有静态协议，或者动态口令生成器，也有的是挑战-应答协议
  - 智能卡是完整的一套处理器，内存，输入输出部件组成的设备。

- 电子身份证
  - 德国的新身份证使用的是电子身份证
  - 包含个人信息，文档编号，卡片接入号，机器读卡区
  - 用于epass，为政府部门所用，是离线功能；eid用于商业应用，既可以离线也可以在线；esign，用于生成持卡人的数字签名。

  - 口令认证连接设施，用于确保非经过许可的情况下，任何设备不可以读取RFID这样的信息


## 生物特征

  - 面部识别
    - 常用的是对人的面部进行照相，然后基于相对位置和关键面部器官建立特征
    - 还有一种就是使用红外摄像机对人脸内部隐含的血管系统生成面部温谱图
  - 指纹
    - 被认为是独一无二的
  - 手型
    - 手掌的特征，包括形状，大小，长度，宽度
  - 视网膜：这个使用的比较少了
  - 虹膜： 开始应用的比较广泛
  - 签名： 银行会需要用，但是签名的比对非常复杂，因为一个人在不同的时间签名的样本也会发生很大的变化。
  - 语音：这个很多app已经在使用


## 远程用户认证

  本地认证是最简单的。复杂一些的是通过网络或者其他通讯线路进行认证。
  远程认证的方式由于跨了设备和路线，所以相对存在较多的安全隐患。

 - 使用口令协议
  远程服务器存储的是口令的散列。
  过程如下：
  1. 用户先发送自己的身份给远程主机
  2. 远程主机生成一个随机数r，通常称为nonce值，并返回这个值给用户
  3. 远程主机需要指定两个函数h和f，在响应过程中使用
  4. 从远程主机到用户的数据传输称为质询。用户响应的是函数f(r,h(p))=r的值。其中p是用户的口令。函数h是一个散列函数。
  5. 远程主机存储了每一个注册用户的口令的散列。对于用户u使用h(p(u))表示。
    当收到用户应答时候，远程主机计算函数f(r,h(p(u)))的值和收到的f(r,h(p))的值进行比较。如果相等，那么用户就被许可。

- 使用令牌协议


- 使用静态生物特征认证


- 使用动态生物特征认证

  - 远程主机提供一个随机序列x和一个随机数r作为质询。这个质询序列是由数字，字符或者单词组成的序列。
  用户必须通过发音，打字或者手写来产证一个生物特征序列信号bs(x).之后，客户端对生物信号和随机数加密。
  远程主机收到信息后进行解密，收到的随机数必须和最初作为质询的随机数r完全匹配才可以。
  并且，远程主机根据输入的生物特征信号bs(x),已经存储的用户模版bt(u)以及原始信号x生成一个比较值，如果改比较值超过了预设的阈值，那么就可以通过验证。


## 潜在的安全问题

- 客户端攻击
- 主机攻击
- 窃听，盗窃和复制口令，令牌和生物特征
- 重放
- 特洛伊木马
- 拒绝服务

## 实际应用

- 阿联酋入境处使用虹膜生物特征认证系统。
- 特点：
  1. 海量人群识别
  2. 依赖于长期不变的生物特征
  3. 该生物特征容易提取
  4. 方便使用
  5. 可以实时响应
  6. 安全无伤害
  7. 能够在超大范围内进行区分并且性能很好
  8. 价格上面负担的起

- 实现
### 阿联酋入境处

 1. 阿联酋17个入境处均设有虹膜扫描仪
 2. 虹膜扫描仪会在距离眼球5-24英寸的地方拍摄黑白照片
 3. 使用近红外照明技术，不可见并且绝对安全
 4. 首先确定虹膜的内外边界以及眼睑的轮廓
 5. 将虹膜的纹理转化为数字编码
 6. 将编码与存在数据库中的编码进行匹配判断
 7. 利用分布式网络，所有入境乘客的虹膜编码都可以实时的与中央数据库进行比对


漏洞：依然有被禁止入境的人，使用滴眼液扩张虹膜，而导致虹膜识别不了，进入阿联酋的案例。因此算法还需要对虹膜的状态进行判断，是常态还是扩张后的。

### ATM系统安全

  1. 禁止明文传输
  2. 分离网络


## 访问控制

概念：对于每个具体的系统资源，谁或者什么（比如应用进程）可以访问，以及每个实例允许的访问类型。

包括：

- 认证：验证用户或者其他系统实体声称的身份是有效的
- 授权：授予系统实体访问系统的权限和许可。确定谁对于给定的目的是可信的
- 审计：对系统记录和活动进行独立评审和检查，确保系统控制措施的充分性，既定策略和操作规程，安全违规，并推荐控制措施，策略等的优化

### 访问控制策略

- 自主访问控制：基于请求者的身份和访问规则控制访问，规定请求者可以或者不可以做什么
- 强制访问控制：通过比较具有安全许可的安全标记来控制访问
- 基于角色的访问：通过用户在系统中所具有的角色来控制访问
- 基于属性控制：基于用户，被访问资源以及当前环境条件来控制访问

- 实例
   - UNIX文件访问控制

   unix的文件都由操作系统通过inode管理。inode是index node的缩写。是操作系统对一个文件所需的关键信息的控制结构。几个文件名可以与一个inode关联
   但是一个活动inode仅和一个文件关联，一个文件也仅被一个inode控制。文件的属性以及访问许可和其他
   的控制信息都存储在inode中。在磁盘上有一个inode表，包含了文件系统中所有文件的inode。打开这个文件时，
   它的inode被读进内存。

   
ICAM是一种用来管理和实现数字身份以及相关属性，凭证，和访问控制的综合性方法。
ICAM由美国政府开发，但是并不仅适用于政府机构，还可以由寻求访问控制统一方法的企业来部署。


## 数据库

这里主要讲关系型数据库。

- 注入攻击

利用数据库应用（一般是查询）中存在的安全漏洞而发起的攻击。攻击者可以提取或者操纵web应用的数据。
用户的输入被当作嵌入在sql语句中的字符串转义符而被错误的过滤或者执行。

  -- 实现过程
  1. 攻击者找到web应用的弱点，然后通过向web服务器发送命令来对数据库注入sql命令。这些命令会被传送到防火墙
  2. web服务器接收到恶意代码，然后发送给web应用服务器
  3. web应用服务器将代码发送给数据库服务器
  3. 数据库服务器在数据库上执行恶意代码，数据库从对应的表中返回数据
  4. web应用服务器动态的生成包含有数据的页面
  5. web服务器向攻击者提供页面

  -- 简单举例

  1. 参看下面的查询语句

```sql
var city;
city=request.from("city")
var sql="select * from ordertable where city='"+city+"'";
```

这个代码的意思是说从用户输入的城市中筛选出所有的订单。

但是如果用户输入的城市名变成这个 beijing‘;drop table ordertable--

那么查询语句就变成这样了： select * from ordertable where city ='beijing';drop table ordertable--

这时候的操作就变成查询北京这个城市的订单，然后删除这个订单表。

### sql注入的攻击途径和类型

- 用户输入：采用这一个方式的攻击者，通过精心构造用户输入来注入SQL命令。
- 服务器变量：包含http头部，网络协议头部，环境变量等数据的变量集合。如果这些变量不经过处理就直接记录在数据库中，则可能会产生sql注入漏洞。因为当攻击者能够构造http和网络报头来利用这些漏洞，将数据直接安排在报头中，挡在税局哭中执行对服务器变量的查询语句时，报头中的攻击语句将会被触发。
- 二阶注入：在二阶注入中，恶意用户可以利用系统或数据库中已存在的数据来触发一个sql注入攻击，因此当这种攻击出现时候，引发攻击的输入不是来自用户，而是来自系统本身。

- cookie：当用户再次访问之前已访问过的web应用程序时候，cookie被用于存储用户的状态信息。由于cookie数据是在客户端控制的，在应用服务器利用cookie构造sql查询时，攻击者可以通过更改cookie的值来实现sql查询语句的构造和进行查询功能的修改。

- 物理用户输入：除了web页面请求，还有其他可以被用于sql注入的用户请求。常见的包括条形码，射频识别标签，甚至是能够利用图像识别技术扫描然后发送到数据库系统的纸质形式。
这种攻击方式大体上包含，带内，带外，和推理三种方式。

> 带内攻击是使用同样的通信信道来完成注入sql代码和返回。

比如，将代码注入一个或者多个永真的表达式中。

$query="select info from user where name='$_get["name"]' and pwd='$_get["pwd"]'";

假如攻击者提交 “‘or 1=1 --'"作为名字字段，那么查询语句就变成这样：

select info from user where name=' ' or 1=1 -- and pwd = ' '

这样就导致口令检查失效，因为--会导致后面的查询变成不可执行的注释。

> 推理攻击： 没有实际的数据传输。但攻击者能够通过发送特定的请求和观察网站的数据库服务器的响应规律来重新构造信息。
 
 - 非法/逻辑错误查询
 - 盲sql注入：攻击者推测数据库系统的数据，利用错误页面的信息等获得结构

> 带外攻击： 返回数据使用不同的通信频道。比如一个带有查询结果的email生成和返回是在不同的信道进的。这一方式用于信息检索有限制但数据库服务器带外连接不严格的情况。

### sql注入的应对措施

- 手动防御性编码： 如果是数值型的输入，应该检查是否只包含数字。一般采用模式匹配进行区分
- 参数化查询：指定sql查询结构，分离传递值参数
- sql dom：它将查询建立过程由使用字符串拼接的不规范过程变成为具有类型检查api的语义构建过程。
- 基于特征的攻击
- 基于异常的攻击
- 代码分析

## 云安全



## 恶意软件

定义： 被秘密的植入系统中，以损害受害者数据，应用程序或者操作系统的可信性，完整性或者可用性，抑或对用户实施骚扰或妨碍的程序。

传染的机制包括：病毒，蠕虫和木马。

有效负载包括：系统损坏，僵尸网络，网络钓鱼，间谍软件rootkit等

类型：
- APT：商业性或者政治性的目标，使用多种入侵技术和恶意软件并在长期持续有效的攻击目标
- 广告软件
- 攻击工具包
- auto-rooter：用于远程入侵到新的机器上的恶意攻击工具
- 后门：能够绕过正常安全检查的机制，并允许未经授权的访问
- 下载器：在被攻击的机器上面安装其他的内容的程序
- 夹带式下载：利用被俘虏的网站，当该网站被访问时候，被植入的恶意代码可以利用浏览器漏洞攻击访问者的系统
- 漏洞攻击：针对某个漏洞进行攻击的代码
- 泛洪式攻击： 通过联网的计算机发起大量的数据包，实现拒绝服务攻击的程序
- 键盘记录器： 捕获侵入系统的键盘输入
- 逻辑炸弹： 潜伏在正常的软件程序中。当满足预定义的某些条件时候，逻辑炸弹触发，执行恶意操作
- 宏病毒： 使用宏或者脚本语言写的病毒，通常植入到文档中，当浏览或编辑文档时候被触发，复制自身到其他的文档
- 移动代码：能够不加修改的移植到不同类型的系统平台并执行
- rootkit：攻击者成功入侵计算机并获得root访问权限
- 垃圾邮件
- 间谍软件：通过监听键盘输入，显示器数据，网络流量或搜素系统文件获取敏感资源信息，并传送到其他的设备的软件
- 木马：看上去有作用，但是还具备其他隐藏的潜在的恶意功能，并且用来避开安全机制
- 病毒
- 蠕虫：能够独立执行，并且可以将自己完整的复制到其他网络主机的程序
- 僵尸： 在被感染的计算机中运行，激活后向其他的计算机发送攻击的程序


点击劫持：就是在一个按钮或者输入框上面或者下面蒙一层新的透明不可见的按钮或者输入框，当用户输入或者点击按钮的时候，触发隐藏的操作。

bot: 最开始使用的是irc，所有受控机器加入一个irc频道，控制机在频道内进行指令发送给受控机。后来专用http协议实现隐蔽通道，避免单一控制节点的问题，再后来使用p2p的方式，也是避免控制节点单一失效的问题。

由于固定ip地址很容易被找到和进行封锁。所以现在的恶意软件使用这样的技术：自动生成大量的服务器域名并令恶意软件尝试与所有的这些域名进行连接。即使其中一个服务器名称被破坏，攻击者依然可以用某个域名来重新建立服务器，获得控制。这样要想解决问题，需要技术人员逆向工程以分析其域名生成的算法，然后对所有（大量）的域名进行封锁，这个是很消耗时间和精力的。

还有一种隐藏服务器的技术是使用快速变迁域名(fast-flux dns)技术。它使得与给定服务器域名相关联的ip地址频繁的变动（每隔几分钟），并在大量的服务器代理中轮转，而这些代理往往是僵尸网络的其他成员。这么做会阻止执法机构有效的对他们的威胁采取措施。

键盘记录器，由于大量的使用https和TLS的方式进行数据的传输，所以黑客使用键盘记录器来降低这个收集信息的难度，这里利用软件工具包制作的Zeus网银木马是其中最有名的代表。

rootkitrevealer, 这个工具是mark大神在sysinternal工具包里面包含的一个用于检测rootkit的工具，面向windows，它将使用api的系统扫描结果与不实用api的指令所获得的实际存储视图进行对比。因为rootkit通过修改系统管理员调用所能看到的视图来隐藏自己，而rootkitrevealer刚好利用这个差异来进行判断。

如果检查出一个系统级别的rootkit，那么唯一可靠的方式就是彻底的重新安装新的操作系统。

### 边界管理

- 入口扫描

所有进入企业的流量都需要进行防火墙或入侵检测的探查。这样在入口的时候就屏蔽掉一些入侵和恶意的行为。

- 出口扫描

可以部署在企业内部网络中的各个独立的局域网出口点上，也可以安装在内外网之间。


## 拒绝服务攻击

- 源地址欺骗

大部分的DoS攻击中，所使用数据包的一个共同的特征是所采用伪造的源地址。这个比较容易使用许多操作系统上的原始套接字接口来实现。

操作系统设计者是为了进行某些自定义的网络测试或网络协议的研究而引入原始套接字接口的，并不是用于正常的网络操作。但是由于兼容性和继承性的问题，在如今的操作系统中依然保留原始套接字接口。攻击者可以利用这个标准接口很容易的制造具有伪造属性的数据包。

- SYN欺骗

通过造成服务器上用于管理TCP连接的连接表的溢出，从而攻击网络服务器响应TCP连接请求的能力。这意味着即使合法的用户TCP的请求也得不到服务器的响应。

SYN欺骗是针对系统资源的DoS攻击，就是针对操作系统上网络处理程序的攻击。
大量的伪造源地址的主机向服务器申请TCP握手，正常的话，服务器会响应SYN-ACK包到正常的源地址。通讯完成后，源主机会发送RST信号给服务器，关闭连接。但是伪造的主机没有这样的源地址，也就不会有RST信号发出，服务器就会将这个信息保存在连接表中，而连接表的大小是有限度的，这个表一旦被填满，那么后来来的请求就不会得到服务器的响应。正常情况下，超时的TCP连接请求会立即被清理出TCP连接表，但是攻击者是不断的发送足量的欺骗TCP连接给服务器的，也就是这个TCP连接表会一直被填满，从而无法响应大多数合法的连接请求。

SYN泛洪攻击与SYN欺骗攻击的方式类似，只是泛洪攻击的是数据包的总量，像洪水一样冲垮对方，而SYN欺骗则是用小部分的数据包消耗目标系统上的网络处理程序。

泛洪攻击既使用UDP也可以使用TCP，虽然TCP会很容易被目标服务器拒绝，但是攻击者已经成功的消耗了服务器的网络链路。

一些抵御SYN欺骗的方法：

1. 对于TCP连接，把请求连接的关键信息加密编码存放于cookie中，然后将这个cookie作为服务器的初始序号封装在syn-ack响应包中发送给客户端。当合法用户返回ack应答包时候，要求在ack的应答包中包含序号+1的cookie，然后服务器根据这个cookie来重构那些曾经在tcp连接表中存储的相关信息。
2. 这个技术一般用于防止TCP连接表溢出。
3. 缺点是服务器要消耗一定的计算资源来计算cookie。还有就是限制了一些tcp的扩展功能。比如large window。

这个技术最著名的方法的实现者是： SYN cookie。发明者是Daniel Bernstein。

4. 修改TCP/IP网络处理程序中所使用的参数。包括连接表的大小，当未收到响应时删除表项目的超时时间。虽然这样增加了攻击的难度，但是并不能从根本上预防攻击。
5. 最好的措施是屏蔽IP定向广播的使用。
6. 还有就是判断连接来自人还是机器，增加captcha这样的限制
7. 增加站点的镜像在多个不同的地方，也能增加稳定性和容错能力。





多机系统的间接攻击：
1. 分布式拒绝服务攻击

  - 分层的控制体系： 攻击者将攻击指令下发给执行者僵尸机器，执行者僵尸机器联系它所能管控的代理僵尸机器，代理僵尸机器根据执行者发过来的指令对目标机器进行攻击。这里的指令和通讯很大程度上都是加密的。而且从目标机器上反向查找攻击者变得极其困难。

2. 反射攻击

举个例子，我要攻击的对象是a,我做一些带有a的源地址的数据包给某些网络服务器，网络服务器会响应这些数据包，会将响应的数据包发给a的源地址。当攻击者发送的数量足够大，那么响应包的数据将占满目标系统的网络链路。这些网络服务器成了DDoS攻击的中间媒介，而且他们做的都是正常的反应。这也使得攻击者可以更容易的发起攻击和躲避跟踪。

实现的方式：
- 发起一个小的请求，产生较大的响应数据包的服务。通常UDP服务可以实现这样的目的。比如dns，snmp，isakmp，chargen等
- 中间媒介有较高的网络服务器性能和较好的链接速度。
- 还有就是可以使用tcp sync进行握手攻击。攻击者发送带有虚假源地址的syn数据包给中间媒介，中间媒介会响应一个syn-ack包给这个源地址的主机，而这个主机是真实存在的目标系统。大量的syn-ack包就能产生泛洪的效果。

改进型的，但容易被切断的攻击方式：

一般dns客户端会通过自身的一个端口利用udp协议向dns服务器的53端口发送域名解析请求。
但是攻击者会利用一个虚假的源地址A向dns发送域名解析请求，攻击者使用端口7，这个端口是echo应答协议的端口。dns服务器稍后会向该攻击的受害者A的端口7发送一个响应。如果受害者的机器提供应答服务，它就可能创建一个网络包将收到的数据返回给DNS服务器。如果DNS服务器响应了A的这个包，那么在A和DNS服务器之间就会产生循环。

3. 放大攻击

- 标准的dns协议，一个60字节的udp请求包会生成一个512字节的udp响应包。而ipv6以及其他扩展dns特性，则可以让这个响应包超过4000字节。
- 攻击者构造使用源地址为攻击目标的dns请求包，然后发送给网络上大量的域名服务器，这些域名服务器就会将响应包发送给攻击目标。看起来都是合法的，但是就是这样被利用了。


国际组织希望安装过滤器在路由器或者网关旁边，以用于过滤伪造的源地址，但是ISP以这样会消耗路由器的性能为说法，不支持这样的提议。从而大量的家庭客户端的电脑被用于制造虚假的源地址。


### 基于应用的攻击

- SIP泛洪

IP电话使用的是SIP协议，语法和http类似。有请求和响应两种形式。它的实现方式是这样的：

A的客户端首先向自己所在的代理服务器发起invite请求，目标是B。此时A的代理服务器会经过DNS查询B的代理服务器的地址，然后A的代理服务器会将invite请求发给B的代理服务器，B的代理服务器在接受到这个请求后，将消息转发给B的客户端。B的客户端就会响铃了。

攻击者利用伪造的IP地址向一个SIP代理发送大量的invite请求，或者使用僵尸网络生成大量的invite请求，就会造成DoS攻击。这种攻击第一可以让服务器的资源被无效的invite消耗，第二可以让服务器的网络容量被占用。

- 基于HTTP的攻击

比如当大量的http请求来自不同的bots，就可以消耗相当大的资源。
比如从目标服务器下载大文件的请求会导致web服务器从硬盘中读取文件，然后将文件存在内存中，再将其转化为网络包流，再进行传输，这个过程消耗内存，cpu，网络资源。

这种攻击的变种称为递归http泛洪。bots从给定的http链接触发，通过递归的方式遍历给定的web服务器的所有的链接。也就是爬虫。

Slowloris攻击，利用多线程支持多个到同一个服务器应用程序的请求进行攻击。它不断的发送不完整的http请求，试图独占服务器所有可用的请求处理线程。
Slowloris 背后的关键是它能够以很少带宽消耗引起很大麻烦。

这是使用了HTTP协议规范（RFC2616）：一个空白行必须用来说明请求报头的末尾或者载荷的开始，如果有的话。一旦接收到完整的请求，web服务器便会响应。但是slowloris不发送这个信号给web服务器。

Slowloris 攻击分为 4 个步骤：

- 攻击者首先通过发送多个部分 HTTP 请求标头来打开与目标服务器的多个连接。
- 目标为每个传入请求打开一个线程，目的是在连接完成后关闭该线程。为提高效率，如果连接花费时间太长，服务器将使非常长的连接超时，从而为下一请求释放线程。
- 为了防止目标使连接超时，攻击者会定期向目标发送部分请求标头，以使请求保持活动状态。本质上说：“我还在这里！我很慢，请等我。”
- 目标服务器在等待请求终止时永远无法释放任何打开的部分连接。一旦所有可用线程都被使用，服务器将无法响应来自常规流量的其他请求，从而导致拒绝服务。

减轻slowloris攻击的方式：

- 增加服务器在任何时间允许的最大客户端数量
- 限制传入请求的速率，限制单个ip允许建立的最大连接数，限制慢速传输速度以及限制客户端允许保持连接的最长时间
- 使用反向负载均衡代理服务，保护源站服务器

负载均衡会对http请求报头做完整性检查，除非http客户端发送报头的最后两个回车和换行，否则该请求是不会被送至web服务器的。要说明的是，企业级的入侵检测和入侵防护系统，对与slowloris没有什么效果，因为它走的是合法的http流量。


## 入侵检测

一种监控并分析系统事件的安全服务，目标是发现未经授权而访问系统资源的尝试活动，并提供实时或者近似实时的报警。

包括三个组件：
- 传感器：收集数据，包括网络数据包，日志文件和系统调用记录。收集后转发给分析器
- 分析器：从接受的数据中进行分析，确定是否发生了入侵。如果发生入侵，则输出入侵的证据信息。分析器可以提供指导，用于判断什么活动是入侵导致的。
- 用户接口：用户可以通过这个来查看系统输出以及控制系统的行为。

IDS可以分为下面几类：
- 基于主机的IDS： 检测一台主机的特征和该主机发生的或参与的可疑活动的事件。例如进程识别器，系统调用等
- 基于网络的IDS：监测特定网段或者设备的流量，传输和应用协议等进行分析。
- 分开或混合式IDS：将主机和网路的传感器收集的信息相结合，汇总到中央分析器

身份验证，访问控制和防火墙在阻断入侵方面都有一定的作用。但是入侵检测有下面的表现：
1. 能够不间断的运行，较少需要人的参与
2. 具有容错功能，系统崩溃时，必须能够较快的恢复和重新初始化
3. 抵御破坏。IDS必须能够检测自身，检测是否自己被攻击者修改
4. 对于正运行的系统增加较小的开销
5. 能够根据被检测系统的安全策略进行配置
6. 能过自动适应系统和用户变化
7. 能够扩展用于监控更多的主机
8. 能够提供降级服务，如果某些组件失效，其余部分将最少受到影响
9. 允许动态配置，不需要变更后重启

NIDS检测网络上流向潜在的易受攻击的计算机系统的数据包流量。而HIDS是基于主机的，检测主机上用户和软件的活动。

NIDS通常是企业外围安全防御架构的一部分。通常通过监控流量模式和数据包的内容来检测入侵企图。但是随着加密技术的使用，NIDS已经无法看到数据包内部的有效内容了。这也妨碍了它的作用的发挥。

### 蜜罐

入侵检测技术中一个特别的组件，是用来引诱潜在的攻击者远离关键系统而设计的。作用包括：
1. 转移攻击者的目标
2. 收集有关攻击者活动的信息
3. 引诱攻击者在系统中逗留足够长的时间，以便管理员对攻击做出反应


### 防火墙

针对包过滤防火墙的攻击方式：

1. IP地址欺骗： 入侵者从外部向内部发送数据包，使用的源地址包含内部主机地址。应对措施是，丢弃那些到达外部接口而源地址为标记内部主机地址的包。
2. 源路由攻击：源端指定包通过internet使用的路由，希望可以绕过对源路由信息的安全检查。
3. 细小分段攻击：入侵者利用IP分段来产生特别小的数据分段，并强制将TCP头信息装入分散的分段中。这种攻击主要是为了绕过基于TCP头信息的过滤规则。应对措施：包的第一个分段必须包含最少的预定传输头。如果第一个分段被否决，那么过滤器将记住这个包，并丢弃后继的所有分段。

状态检测防火墙：

状态检测防火墙通过建立一个出战TCP连接目录来强制执行TCP流量规则。只有当数据包符合这个目录中的某项时，才允许通过。状态检测和包检测检查相同的包信息，但是不同的是状态检测防火墙还会记录TCP连接信息。一些状态检测防火墙还跟踪TCP包的序号，以阻止基于序号的攻击。比如会话劫持。

应用级网关（也叫应用代理）：用于应用级流量中继。

用户使用tcp/ip应用程序连接网关，网关要求用户提供要访问的远程主机名。当用户提供了有效的身份验证后，网关会联系远程主机并在远程主机和用户计算机间中继包含应用程序数据的tcp分段。网关可以被设置为只支持某种应用程序的中继。


#### VPN

IPSec VPN是建立在客户端与防火墙之间的一种虚拟网络。
因为IPSec包，除了IP头和载荷数据外，还需要有IPSec头，如果放在网络内部，防火墙无法识别加密流量，也就失去了保护的意义。

分布式防火墙：

外部数据包经过边界路由器后，进入外部防火墙，这里有外部DMZ区。穿过外部防火墙后，进入内部DMZ，再往下有内部防火墙，保护内部的网络，然后各个内部的主机上面还有主机级别的防火墙。

IPS：

基于主机的IPS，用于避免对系统资源的修改，避免提权攻击和缓冲区溢出攻击，以及访问电子邮件通讯录，以及文件目录遍历。

IBM数字免疫系统


一体化的威胁管理产品，UTM。主要的问题是吞吐量和延迟的，现在商业设备普遍的吞吐量损失是50%，客户被建议使用高性能，大吞吐量的设备以避免性能问题。

## 软件安全与可信系统

### 缓冲区溢出

大量的输入被放置到缓冲区或者数据存储区，超过了它所分配的存储能力，覆盖了其他的信息。攻击者利用这样的情况破坏系统或者插入特别编制的代码，以获取系统的控制权。

这是编程错误的结果导致的。发生缓冲区溢出后，会导致程序使用的数据受到破坏，在程序中发生意外的控制权转移，可能的内存非法访问，以及很可能导致程序终止。

当缓冲区溢出被用于攻击系统时，系统的控制权会被转移到攻击者的代码中，此时攻击者可以执行任意的代码在系统中。





